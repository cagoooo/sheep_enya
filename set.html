<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰›å¥½å­¸ - Firebase é…ç½®ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .input-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
            transition: border-color 0.2s;
            resize: vertical;
            min-height: 300px;
            background-color: #f9fafb;
        }
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background-color: white;
        }
        .btn {
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #ffffff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .code-example {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin-top: 0.5rem;
        }
        .code-example .comment {
            color: #9ca3af;
        }
        .code-block-container {
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .copy-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        .copy-btn.copied {
            background: #10b981;
        }
        .highlight-text {
            font-weight: 700;
            color: #7c3aed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-cog text-purple-600"></i> å‰›å¥½å­¸
                </h1>
                <p class="text-xl text-gray-600">Firebase é…ç½®ç”Ÿæˆå™¨</p>
            </div>

            <div class="alert alert-info">
                <i class="fas fa-lightbulb mr-2"></i>
                <strong>å¿«é€Ÿä¸Šæ‰‹ï¼š</strong>åªéœ€ä¸€å€‹æ­¥é©Ÿï¼ç›´æ¥å¾ Firebase Console è¤‡è£½é…ç½®ä»£ç¢¼ï¼Œè²¼ä¸Šä¸‹æ–¹æ–‡æœ¬æ¡†ï¼Œé»æ“Šç”Ÿæˆå³å¯ä¸‹è¼‰æ‚¨çš„å°ˆå±¬æ‡‰ç”¨ç¨‹å¼ã€‚
            </div>

            <form id="config-form">
                <div class="input-group">
                    <label for="firebaseConfig">
                        <i class="fas fa-code text-purple-600 mr-2"></i>Firebase é…ç½®ä»£ç¢¼
                        <span class="text-sm text-gray-500 font-normal ml-2">(ç›´æ¥å¾ Firebase Console è¤‡è£½è²¼ä¸Š)</span>
                    </label>
                    <textarea 
                        id="firebaseConfig" 
                        name="firebaseConfig" 
                        placeholder="è«‹è²¼ä¸Šæ‚¨çš„ Firebase é…ç½®ä»£ç¢¼ï¼Œä¾‹å¦‚ï¼š

const firebaseConfig = {
  apiKey: &quot;AIzaSyC...&quot;,
  authDomain: &quot;your-project.firebaseapp.com&quot;,
  projectId: &quot;your-project&quot;,
  storageBucket: &quot;your-project.appspot.com&quot;,
  messagingSenderId: &quot;123456789012&quot;,
  appId: &quot;1:123456789012:web:...&quot;
};

æˆ–è€…åªè²¼ä¸Šé…ç½®ç‰©ä»¶ï¼š

{
  apiKey: &quot;AIzaSyC...&quot;,
  authDomain: &quot;your-project.firebaseapp.com&quot;,
  projectId: &quot;your-project&quot;,
  storageBucket: &quot;your-project.appspot.com&quot;,
  messagingSenderId: &quot;123456789012&quot;,
  appId: &quot;1:123456789012:web:...&quot;
}"
                        required
                    ></textarea>
                </div>

                <div id="message-container"></div>

                <div class="text-center">
                    <button type="submit" id="generate-btn" class="btn btn-primary">
                        <i class="fas fa-download mr-2"></i>ç”Ÿæˆä¸¦ä¸‹è¼‰ index.html
                    </button>
                </div>
            </form>

            <div class="mt-8 p-6 bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl border-2 border-purple-200">
                <h3 class="font-bold text-gray-800 mb-4 text-xl">
                    <i class="fas fa-cog text-purple-600 mr-2"></i>ğŸ”§ å»ºç½®ä¸»ç¨‹å¼è³‡æ–™åº«è¨­å®š(Firebase)
                </h3>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-5 rounded">
                    <p class="text-gray-700 mb-2">
                        æœ¬ç³»çµ±éœ€è¦é€£æ¥åˆ° <strong>Google Firebase è³‡æ–™åº«</strong>æ‰èƒ½é‹ä½œï¼Œæ‚¨éœ€è‡ªè¡ŒæŒ‰ç…§æœ¬èªªæ˜å®Œæˆå»ºç½®å¾Œï¼Œæ‰å¯æ­£å¸¸ä½¿ç”¨ã€‚é€™èƒ½ç¢ºä¿æ‰€æœ‰èª²å ‚è³‡æ–™ï¼ˆå¦‚å­¸ç”Ÿç­”æ¡ˆï¼‰éƒ½ä¿å­˜åœ¨æ‚¨è‡ªå·±çš„ç©ºé–“ï¼Œç¢ºä¿è³‡æ–™çš„éš±ç§èˆ‡æ‰€æœ‰æ¬Šã€‚
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-1"></i>
                        <strong>æ³¨æ„ï¼š</strong>æ­¤ç‚ºå¿…è¦è¨­å®šæ­¥é©Ÿï¼Œéœ€è¦æ‚¨å…·å‚™åŸºæœ¬çš„ Google Firebase æ“ä½œçŸ¥è­˜ã€‚è‹¥æœªå®Œæˆæ­¤è¨­å®šï¼Œç³»çµ±å°‡ç„¡æ³•ä½¿ç”¨ã€‚
                    </p>
                </div>

                <!-- æ­¥é©Ÿ 1 -->
                <div class="mb-6">
                    <h4 class="font-bold text-purple-700 mb-2 text-lg">
                        <span class="bg-purple-600 text-white rounded-full w-7 h-7 inline-flex items-center justify-center mr-2 text-sm">1</span>
                        å»ºç«‹ Firebase å°ˆæ¡ˆ
                    </h4>
                    <ul class="ml-10 text-gray-700 space-y-1">
                        <li>â€¢ å‰å¾€ <a href="https://console.firebase.google.com/" target="_blank" class="text-purple-600 hover:underline font-semibold">Firebase Console</a>ï¼ˆè¶…é€£çµï¼‰</li>
                        <li>â€¢ é»æ“Šã€Œæ–°å¢å°ˆæ¡ˆã€ä¸¦ä¾ç…§æŒ‡ç¤ºå®Œæˆå»ºç«‹</li>
                    </ul>
                </div>

                <!-- æ­¥é©Ÿ 2 -->
                <div class="mb-6">
                    <h4 class="font-bold text-purple-700 mb-2 text-lg">
                        <span class="bg-purple-600 text-white rounded-full w-7 h-7 inline-flex items-center justify-center mr-2 text-sm">2</span>
                        å•Ÿç”¨å¿…è¦æœå‹™
                    </h4>
                    <div class="ml-10 space-y-3">
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">
                                <i class="fas fa-user-shield text-blue-600 mr-1"></i> Authentication (é©—è­‰)
                            </p>
                            <p class="text-gray-700 ml-5">åœ¨å°ˆæ¡ˆå·¦å´<span class="highlight-text">ã€Œå»ºæ§‹ã€</span>ä¸­æ‰¾åˆ°<span class="highlight-text">ã€ŒAuthenticationã€</span>ï¼Œé»æ“Š<span class="highlight-text">ã€Œé–‹å§‹ä½¿ç”¨ã€</span>ï¼Œé€²å…¥<span class="highlight-text">ã€Œç™»å…¥æ–¹å¼ã€</span>åˆ†é ï¼Œä¸¦<span class="highlight-text">ã€Œå•Ÿç”¨ã€</span><span class="highlight-text">ã€ŒåŒ¿åã€</span>ç™»å…¥æ–¹å¼ã€‚</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">
                                <i class="fas fa-database text-orange-600 mr-1"></i> Firestore Database (è³‡æ–™åº«)
                            </p>
                            <p class="text-gray-700 ml-5">åœ¨å°ˆæ¡ˆå·¦å´<span class="highlight-text">ã€Œå»ºæ§‹ã€</span>ä¸­æ‰¾åˆ°<span class="highlight-text">ã€ŒFirestore Databaseã€</span>ï¼Œé»æ“Š<span class="highlight-text">ã€Œå»ºç«‹è³‡æ–™åº«ã€</span>å¾Œé»é¸<span class="highlight-text">ã€ŒStandardç‰ˆã€</span>ï¼Œæ¥è‘—ä¸‹ä¸€æ­¥ä½ç½®æ”¹æˆ<span class="highlight-text">ã€Œasia-east1 (Taiwan)ã€</span>è®€å–è³‡æ–™æ‰èƒ½éå¸¸å¿«é€Ÿï¼Œæœ€å¾Œé¸æ“‡ä»¥<span class="highlight-text">ã€Œæ¸¬è©¦æ¨¡å¼ã€</span>å•Ÿå‹•ã€‚</p>
                        </div>
                    </div>
                </div>

                <!-- æ­¥é©Ÿ 3 -->
                <div class="mb-6 bg-red-50 border-2 border-red-300 p-4 rounded-lg">
                    <h4 class="font-bold text-red-700 mb-3 text-lg">
                        <span class="bg-red-600 text-white rounded-full w-7 h-7 inline-flex items-center justify-center mr-2 text-sm">3</span>
                        ä¿®æ”¹ Firestore å®‰å…¨æ€§è¦å‰‡ (éå¸¸é‡è¦ï¼)
                    </h4>
                    <div class="ml-10 space-y-2">
                        <p class="text-gray-700">è³‡æ–™åº«å»ºç«‹å¾Œï¼Œåœ¨å°ˆæ¡ˆå·¦å´<span class="highlight-text">ã€Œå»ºæ§‹ã€</span>ä¸­æ‰¾åˆ° Firestore Database é é¢ï¼Œé»æ“Šä¸Šæ–¹çš„<span class="highlight-text">ã€Œè¦å‰‡ã€</span>(Rules) åˆ†é ã€‚</p>
                        <p class="text-gray-700">å°‡ç·¨è¼¯å™¨ä¸­çš„æ‰€æœ‰å…§å®¹ï¼Œæ›¿æ›ç‚ºä»¥ä¸‹è¦å‰‡ï¼š</p>
                        <div class="code-block-container">
                            <button class="copy-btn" onclick="copyFirestoreRules(this)">
                                <i class="fas fa-copy mr-1"></i>è¤‡è£½
                            </button>
                            <div class="code-example bg-gray-900 text-gray-100 p-4 rounded mt-2 overflow-x-auto">
<pre class="text-sm" id="firestore-rules">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}</pre>
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm mt-2">
                            <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
                            é€™æ¢è¦å‰‡çš„æ„æ€æ˜¯ã€Œå…è¨±ä»»ä½•å·²ç™»å…¥çš„ä½¿ç”¨è€…ï¼ˆåŒ…å«æˆ‘å€‘å‰›æ‰å•Ÿç”¨çš„åŒ¿åç™»å…¥ï¼‰å°è³‡æ–™åº«é€²è¡Œè®€å¯«ã€ã€‚
                        </p>
                        <p class="text-gray-700 font-semibold mt-3">
                            <i class="fas fa-check-circle text-green-600 mr-1"></i>
                            ä¿®æ”¹å®Œæˆå¾Œï¼Œé»æ“Š<span class="highlight-text">ã€Œç™¼ä½ˆã€</span>(Publish) ä¾†å„²å­˜æ‚¨çš„æ–°è¦å‰‡ã€‚
                        </p>
                    </div>
                </div>

                <!-- æ­¥é©Ÿ 4 -->
                <div class="mb-4">
                    <h4 class="font-bold text-purple-700 mb-2 text-lg">
                        <span class="bg-purple-600 text-white rounded-full w-7 h-7 inline-flex items-center justify-center mr-2 text-sm">4</span>
                        å–å¾—æ‚¨çš„ Firebase è¨­å®šå€¼
                    </h4>
                    <div class="ml-10 space-y-2">
                        <p class="text-gray-700">â‘  åœ¨ Firebase Console ä¸­ï¼Œé»æ“Šå°ˆæ¡ˆé¦–é å·¦ä¸Šè§’çš„é½’è¼ªåœ–ç¤º <i class="fas fa-cog text-gray-600"></i>ï¼Œé¸æ“‡<span class="highlight-text">ã€Œå°ˆæ¡ˆè¨­å®šã€</span>ã€‚</p>
                        <p class="text-gray-700">â‘¡ åœ¨<span class="highlight-text">ã€Œæ‚¨çš„æ‡‰ç”¨ç¨‹å¼ã€</span>å€å¡Šï¼Œé»æ“Š<span class="highlight-text">ã€Œæ–°å¢æ‡‰ç”¨ç¨‹å¼ã€</span>ä¸¦é¸æ“‡<span class="highlight-text">ã€Œç¶²é ã€</span>åœ–ç¤º (<code>&lt;/&gt;</code>)ã€‚</p>
                        <p class="text-gray-700">â‘¢ ç‚ºæ‚¨çš„æ‡‰ç”¨ç¨‹å¼å‘½åå¾Œï¼Œé»æ“Š<span class="highlight-text">ã€Œè¨»å†Šæ‡‰ç”¨ç¨‹å¼ã€</span>æŒ‰éˆ•ï¼Œæ‚¨æœƒçœ‹åˆ°ä¸€çµ„ <code class="bg-purple-100 px-2 py-1 rounded text-purple-700 font-semibold">firebaseConfig</code> è¨­å®šå€¼ã€‚è«‹å°‡å®ƒè¤‡è£½ä¸‹ä¾†ã€‚</p>
                        <div class="code-example bg-gray-900 text-gray-100 p-4 rounded mt-2 overflow-x-auto">
<pre class="text-sm">const firebaseConfig = {
  apiKey: "AIzaSy...",
  authDomain: "xxx.firebaseapp.com",
  projectId: "xxx",
  storageBucket: "xxx.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:..."
};</pre>
                        </div>
                        <p class="text-gray-700 font-semibold mt-3 bg-green-100 border-l-4 border-green-500 p-3 rounded">
                            <i class="fas fa-arrow-up text-green-600 mr-1"></i>
                            å°‡é€™æ®µé…ç½®ä»£ç¢¼è¤‡è£½å¾Œï¼Œè²¼åˆ°æœ¬é é¢æœ€ä¸Šæ–¹çš„æ–‡æœ¬æ¡†ï¼Œç„¶å¾Œé»æ“Š<span class="highlight-text">ã€Œç”Ÿæˆä¸¦ä¸‹è¼‰ã€</span>æŒ‰éˆ•å³å¯ï¼
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- GitHub Pages éƒ¨ç½²èªªæ˜ -->
            <div class="mt-6 p-5 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border-2 border-green-200">
                <h3 class="font-bold text-gray-800 mb-3 text-lg">
                    <i class="fas fa-rocket text-green-600 mr-2"></i>ä¸‹ä¸€æ­¥ï¼šç™¼å¸ƒæ‚¨çš„æ‡‰ç”¨ç¨‹å¼åˆ°ç¶²è·¯ä¸Š
                </h3>
                <p class="text-gray-700 mb-4">
                    ä¸‹è¼‰å®Œæˆå¾Œï¼Œè«‹å°‡å‰›å‰›ä¸‹è¼‰çš„ <code class="bg-white px-2 py-1 rounded text-sm font-semibold text-purple-700">index.html</code> ä¸Šå‚³åˆ°ä»¥ä¸‹ç¶²ç«™å³å¯å…è²»ç™¼å¸ƒæ‚¨çš„æ‡‰ç”¨ç¨‹å¼ï¼š
                </p>
                <div class="text-center">
                    <a href="https://gg90052.github.io/ezpage/" 
                       target="_blank" 
                       class="inline-block bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-4 rounded-lg font-bold text-lg hover:shadow-xl transition-all transform hover:scale-105">
                        <i class="fas fa-cloud-upload-alt mr-2"></i>å‰å¾€ GitHub Pages ç™¼å¸ƒå·¥å…·
                        <i class="fas fa-external-link-alt ml-2 text-sm"></i>
                    </a>
                </div>
                <p class="text-sm text-gray-600 mt-4 text-center">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    ä¸Šå‚³å¾Œï¼Œæ‚¨å°‡ç²å¾—ä¸€å€‹å…¬é–‹ç¶²å€ï¼Œå­¸ç”Ÿå¯ä»¥ç›´æ¥é€éç€è¦½å™¨ä½¿ç”¨æ‚¨çš„æ•™å­¸å·¥å…·ï¼
                </p>
            </div>
            
            <!-- Google AI Studio API KEY ç²å–èªªæ˜ -->
            <div class="mt-6 p-5 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg border-2 border-orange-200">
                <h3 class="font-bold text-gray-800 mb-3 text-lg">
                    <i class="fas fa-magic text-orange-600 mr-2"></i>ä¸‹ä¸€æ­¥ï¼šå•Ÿç”¨ AI ç”Ÿæˆé¡Œç›®åŠŸèƒ½ï¼ˆå®Œå…¨å…è²»ï¼‰
                </h3>
                <p class="text-gray-700 mb-4">
                    æƒ³è¦ä½¿ç”¨ <strong>AI è‡ªå‹•ç”Ÿæˆ PIRLS é–±è®€ç†è§£é¡Œçµ„</strong>å—ï¼Ÿå‰å¾€ Google AI Studio ç²å–å®Œå…¨å…è²»çš„ API Keyï¼š
                </p>
                <div class="text-center">
                    <a href="https://aistudio.google.com/" 
                       target="_blank" 
                       class="inline-block bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-8 py-4 rounded-lg font-bold text-lg hover:shadow-xl transition-all transform hover:scale-105">
                        <i class="fas fa-brain mr-2"></i>å‰å¾€ Google AI Studio ç²å– API Key
                        <i class="fas fa-external-link-alt ml-2 text-sm"></i>
                    </a>
                </div>
                <div class="mt-4 p-3 bg-white rounded-lg border border-orange-200">
                    <p class="text-sm text-gray-700 mb-2">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>
                        <strong>åŠŸèƒ½ä»‹ç´¹ï¼š</strong>
                    </p>
                    <ul class="text-sm text-gray-600 ml-6 space-y-1">
                        <li>âœ¨ AI æ™ºèƒ½ç”Ÿæˆç¬¦åˆ PIRLS æ¨™æº–çš„é–±è®€ç†è§£é¡Œçµ„</li>
                        <li>ğŸ“š è‡ªå‹•æ ¹æ“šæ–‡ç« å…§å®¹ç”¢ç”Ÿå¤šå±¤æ¬¡å•é¡Œ</li>
                        <li>ğŸ¯ æ”¯æ´ä¸åŒé›£åº¦èˆ‡é¡Œå‹çš„é¡Œç›®ç”Ÿæˆ</li>
                        <li>ğŸ’° <strong>å®Œå…¨å…è²»</strong>ä½¿ç”¨ Google çš„ Gemini AI æ¨¡å‹</li>
                    </ul>
                </div>
                <p class="text-sm text-gray-600 mt-3 text-center">
                    <i class="fas fa-key text-orange-500 mr-1"></i>
                    ç²å¾— API Key å¾Œï¼Œåœ¨æ‡‰ç”¨ç¨‹å¼ä¸­è¼¸å…¥å³å¯é–‹å§‹ä½¿ç”¨ AI ç”Ÿæˆé¡Œç›®åŠŸèƒ½ï¼
                </p>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('config-form');
        const generateBtn = document.getElementById('generate-btn');
        const messageContainer = document.getElementById('message-container');

        function showMessage(message, type = 'info') {
            messageContainer.innerHTML = `
                <div class="alert alert-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
        }

        function parseFirebaseConfig(configText) {
            try {
                // æ¸…ç†æ–‡æœ¬ï¼šç§»é™¤å‰å¾Œç©ºç™½
                configText = configText.trim();
                
                // æª¢æŸ¥é–‹å§‹å’ŒçµæŸæ‹¬è™Ÿ
                const hasOpeningBrace = configText.indexOf('{') !== -1;
                const hasClosingBrace = configText.lastIndexOf('}') !== -1;
                
                let jsonText = configText;
                
                // å…ˆç§»é™¤ const è²æ˜éƒ¨åˆ†ï¼ˆå¦‚æœæœ‰ï¼‰
                jsonText = jsonText.replace(/^const\s+\w+\s*=\s*/, '');
                
                // ç§»é™¤å°¾éƒ¨çš„åˆ†è™Ÿï¼ˆåœ¨æ·»åŠ æ‹¬è™Ÿä¹‹å‰ï¼‰
                jsonText = jsonText.replace(/;[\s]*$/, '').trim();
                
                // æ ¹æ“šæ‹¬è™Ÿæƒ…æ³é€²è¡Œè™•ç†
                if (!hasOpeningBrace && !hasClosingBrace) {
                    // å…©å€‹æ‹¬è™Ÿéƒ½æ²’æœ‰ï¼šç›´æ¥æ·»åŠ å…©å€‹æ‹¬è™Ÿ
                    jsonText = '{' + jsonText + '}';
                } else if (!hasOpeningBrace && hasClosingBrace) {
                    // åªæœ‰çµæŸæ‹¬è™Ÿï¼šæ·»åŠ é–‹å§‹æ‹¬è™Ÿ
                    jsonText = '{' + jsonText;
                } else if (hasOpeningBrace && !hasClosingBrace) {
                    // åªæœ‰é–‹å§‹æ‹¬è™Ÿï¼šæ·»åŠ çµæŸæ‹¬è™Ÿ
                    jsonText = jsonText + '}';
                } else {
                    // å…©å€‹æ‹¬è™Ÿéƒ½æœ‰ï¼šæå–æ‹¬è™Ÿä¹‹é–“çš„å…§å®¹
                    const firstBrace = jsonText.indexOf('{');
                    const lastBrace = jsonText.lastIndexOf('}');
                    jsonText = jsonText.substring(firstBrace, lastBrace + 1);
                }
                
                // å˜—è©¦ç›´æ¥è§£æï¼ˆå¦‚æœæ˜¯æœ‰æ•ˆçš„ JSONï¼‰
                try {
                    return JSON.parse(jsonText);
                } catch (e) {
                    // å¦‚æœè§£æå¤±æ•—ï¼Œå¯èƒ½æ˜¯å› ç‚ºå±¬æ€§åç¨±æ²’æœ‰å¼•è™Ÿ
                    // å°‡ JavaScript ç‰©ä»¶æ ¼å¼è½‰æ›ç‚º JSON æ ¼å¼
                    
                    // ç‚ºå±¬æ€§åç¨±æ·»åŠ å¼•è™Ÿ
                    jsonText = jsonText.replace(/([{,]\s*)(\w+)(\s*:)/g, '$1"$2"$3');
                    
                    // å°‡å–®å¼•è™Ÿæ›¿æ›ç‚ºé›™å¼•è™Ÿ
                    jsonText = jsonText.replace(/'/g, '"');
                    
                    // å†æ¬¡å˜—è©¦è§£æ
                    return JSON.parse(jsonText);
                }
            } catch (error) {
                throw new Error(`é…ç½®æ ¼å¼éŒ¯èª¤ï¼š${error.message}ã€‚è«‹ç¢ºèªæ‚¨è²¼ä¸Šäº† Firebase é…ç½®çš„å¿…è¦æ¬„ä½ã€‚`);
            }
        }

        function validateConfig(config) {
            const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
            const missingFields = requiredFields.filter(field => !config[field]);
            
            if (missingFields.length > 0) {
                throw new Error(`ç¼ºå°‘å¿…è¦æ¬„ä½ï¼š${missingFields.join(', ')}ã€‚è«‹ç¢ºèªæ‚¨çš„ Firebase é…ç½®å®Œæ•´ã€‚`);
            }
            
            // é©—è­‰æ¬„ä½æ ¼å¼
            if (!config.apiKey.startsWith('AIza')) {
                throw new Error('API Key æ ¼å¼ä¼¼ä¹ä¸æ­£ç¢ºï¼ˆæ‡‰è©²ä»¥ "AIza" é–‹é ­ï¼‰');
            }
            
            if (!config.authDomain.includes('firebaseapp.com') && !config.authDomain.includes('.')) {
                throw new Error('Auth Domain æ ¼å¼ä¼¼ä¹ä¸æ­£ç¢º');
            }
            
            return true;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const configText = document.getElementById('firebaseConfig').value.trim();
            
            if (!configText) {
                showMessage('è«‹è²¼ä¸Šæ‚¨çš„ Firebase é…ç½®ä»£ç¢¼ï¼', 'error');
                return;
            }

            // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span class="spinner mr-2"></span>è§£æä¸¦ç”Ÿæˆä¸­...';
            showMessage('æ­£åœ¨è§£æé…ç½®ä¸¦ç”Ÿæˆæ‚¨çš„å°ˆå±¬æ‡‰ç”¨ç¨‹å¼...', 'info');

            try {
                // è§£æé…ç½®
                const config = parseFirebaseConfig(configText);
                
                // é©—è­‰é…ç½®
                validateConfig(config);
                
                showMessage('âœ… é…ç½®è§£ææˆåŠŸï¼æ­£åœ¨ç”Ÿæˆæ‡‰ç”¨ç¨‹å¼...', 'info');

                // è®€å– index.html æ¨¡æ¿
                const response = await fetch('index.html');
                if (!response.ok) {
                    throw new Error('ç„¡æ³•è®€å–æ¨¡æ¿æª”æ¡ˆï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šæ­£å¸¸');
                }
                
                let htmlContent = await response.text();

                // æ›¿æ› Firebase é…ç½®
                const configPattern = /const __firebase_config = JSON\.stringify\(\{[\s\S]*?\}\);/;
                
                // æª¢æŸ¥æ¨¡æ¿ä¸­æ˜¯å¦å­˜åœ¨é…ç½®å€å¡Š
                if (!configPattern.test(htmlContent)) {
                    throw new Error('æ¨¡æ¿æª”æ¡ˆä¸­æœªæ‰¾åˆ° Firebase é…ç½®å€å¡Šï¼Œè«‹ç¢ºèªæ¨¡æ¿æª”æ¡ˆå®Œæ•´æ€§');
                }
                
                // ç”Ÿæˆæ–°çš„é…ç½®å­—ä¸²
                const newConfigString = `const __firebase_config = JSON.stringify({
            apiKey: "${config.apiKey}",
            authDomain: "${config.authDomain}",
            projectId: "${config.projectId}",
            storageBucket: "${config.storageBucket}",
            messagingSenderId: "${config.messagingSenderId}",
            appId: "${config.appId}"
        });`;

                const updatedContent = htmlContent.replace(configPattern, newConfigString);

                // å‰µå»º Blob ä¸¦ä¸‹è¼‰
                const blob = new Blob([updatedContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'index.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showMessage(`âœ… æˆåŠŸï¼æ‚¨çš„å°ˆå±¬ã€Œå‰›å¥½å­¸ã€æ‡‰ç”¨ç¨‹å¼ï¼ˆå°ˆæ¡ˆï¼š${config.projectId}ï¼‰å·²é–‹å§‹ä¸‹è¼‰ã€‚ä¸‹è¼‰å®Œæˆå¾Œå³å¯ç›´æ¥ä½¿ç”¨ï¼`, 'success');
                generateBtn.innerHTML = '<i class="fas fa-check mr-2"></i>ç”ŸæˆæˆåŠŸï¼å†æ¬¡ä¸‹è¼‰ï¼Ÿ';

            } catch (error) {
                console.error('ç”Ÿæˆå¤±æ•—:', error);
                showMessage(`âŒ ${error.message}`, 'error');
                generateBtn.innerHTML = '<i class="fas fa-download mr-2"></i>ç”Ÿæˆä¸¦ä¸‹è¼‰ index.html';
            } finally {
                generateBtn.disabled = false;
            }
        });

        // è¤‡è£½ Firestore è¦å‰‡çš„åŠŸèƒ½
        function copyFirestoreRules(button) {
            const rulesText = document.getElementById('firestore-rules').textContent;
            
            navigator.clipboard.writeText(rulesText).then(() => {
                // æ›´æ”¹æŒ‰éˆ•ç‹€æ…‹ç‚ºå·²è¤‡è£½
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-1"></i>å·²è¤‡è£½ï¼';
                button.classList.add('copied');
                
                // 2 ç§’å¾Œæ¢å¾©åŸç‹€
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
            });
        }
    </script>
</body>
</html>
